# Middleware in Express.js

Middleware plays a crucial role in Express.js applications as it allows us to add additional functionality to the request-response cycle. In this lesson, we will explore what middleware is and how it works in Express.

## What is Middleware?

Middleware is a function that has access to the request and response objects and the next middleware function in the application's request-response cycle. It can perform tasks such as modifying the request or response objects, executing additional code, or terminating the request-response cycle.

## Built-in Middleware

Express provides several built-in middleware functions that can be used in an application. Some common examples include:

- `express.json()`: Parses incoming requests with JSON payloads.
- `express.urlencoded()`: Parses incoming requests with URL-encoded payloads.
- `express.static()`: Serves static files from a directory.

## Third-Party Middleware

In addition to the built-in middleware, Express allows us to use third-party middleware to enhance our application's functionality. Some popular third-party middleware modules include:

- `body-parser`: Parses incoming request bodies.
- `cookie-parser`: Parses cookie headers.
- `morgan`: Logs HTTP requests.

## Implementing Middleware

To implement middleware in an Express application, we use the `app.use()` method. This method takes a middleware function as an argument and adds it to the application's middleware stack.

Here's an example of implementing logging middleware:

```javascript
app.use((req, res, next) => {
  console.log(`${req.method} ${req.url}`);
  next();
});
```

In this example, the middleware function logs the HTTP method and URL of each incoming request.

## Practical Example: Logging and Request Body Parsing

Let's see a practical example of implementing logging and request body parsing middleware in an Express application.

```javascript
const express = require('express');
const app = express();

// Logging middleware
app.use((req, res, next) => {
  console.log(`${req.method} ${req.url}`);
  next();
});

// Request body parsing middleware
app.use(express.json());

// Routes
// ...

app.listen(3000, () => {
  console.log('Server is running on port 3000');
});
```

In this example, we have added logging middleware that logs the HTTP method and URL of each request, and request body parsing middleware that parses incoming JSON payloads.

## Exercise: Adding Authentication Middleware

Your task for this exercise is to add authentication middleware to an existing Express application. The middleware should check if the request contains a valid authentication token and allow access to protected routes only if the token is valid. Otherwise, it should return a 401 Unauthorized response.

```javascript
// Authentication middleware
app.use((req, res, next) => {
  const token = req.headers.authorization;

  if (!token) {
    return res.status(401).json({ message: 'Unauthorized' });
  }

  // Verify token and authenticate user
  // ...

  next();
});
```

In this exercise, you will need to implement the logic to verify the authentication token and authenticate the user based on the token.

---

Middleware is a powerful feature in Express.js that allows us to add functionality to our applications. By understanding how middleware works and using it effectively, we can enhance the capabilities of our Express applications.
```

Please note that the code examples provided in the markdown file are for illustrative purposes and may require additional implementation or modification to work in a specific project.